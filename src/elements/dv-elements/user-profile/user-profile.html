<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/paper-styles/element-styles/paper-material-styles.html">
<link rel="import" href="../../../bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="../../../bower_components/vaadin-grid/vaadin-grid-column-group.html">
<link rel="import" href="../../../elements/dv-elements/admin/dv-vaadin-theme.html">
<link rel="import" href="../../../elements/dv-elements/admin/dv-admin-mixins.html">
<link rel="import" href="../../../elements/dv-elements/utils/mixins/commons.html">

<link rel="import" href="./user-image/user-image.html">
<link rel="import" href="../user-authentication/role-request/role-request.html">
<dom-module id="user-profile">
    <template>
        <style include="paper-material-styles">
            :host {
                display: flex;
                justify-content: center;
                min-width: 500px;
            }
            .paper-material {
                margin-top: 20px;
                width: 500px;
                background:#fff;
            }
            .paper-material + .paper-material {
                margin-top: 5px;
            }

            .paper-material .paper-material-inner {
                width: 100%;
                box-sizing: border-box;
            }

            .border-top {
                border-top: 5px solid #333;
            }

            .display-flex {
                display: flex;
            }
            .column {
                flex-direction: column;
            }
            .username-header {
                font-family: 'Roboto', 'Noto', sans-serif;
                -webkit-font-smoothing: antialiased;
                font-size: 48px;
                font-weight: 400;
                letter-spacing: -.012em;
                line-height: 48px;
            }
            .image-holder {
                width: 100px;
                justify-content: center;
            }
            .btn{
                background-color: #4285f4;
                color: white;
                --paper-button-raised-keyboard-focus: {
                    background-color: #4285f4 !important;
                    color: white !important;
                };
                border: none !important;
                text-transform: none;
                border-radius: 0 !important;
                margin: 0 !important;
                float: right;
            }
            .flex {
                flex: 1 1 auto;
            }
            .label {
                min-width: 150px;
                max-width: 150px;
            }
            .bold {
                font-weight: bold;
            }
            .value {
                color: #757575;
                max-width: calc(452px - 150px + 68px);
                max-height: calc(70px - 24px);
                overflow-y: auto;
                word-wrap: break-word;
                margin-right: 10px;
            }
            .org {
                margin-top: 5px;
                margin-bottom: 5px;
                color: #ff625d;
                font-size: 0.8em;
            }
            .row {
                height: 70px;
                margin: 0 24px;
                padding: 24px 0;
                line-height: 1.4em;
                font-size: 12px;
                box-sizing: border-box;
            }
            .row + .row {
                border-top: 1px solid #eee;
            }
            .vertically-align {
                align-items: center;
            }
            .toggleBtn {
                --paper-toggle-button-checked-bar-color:  #0f9d58;
                --paper-toggle-button-checked-button-color:  #0f9d58;
                --paper-toggle-button-checked-ink-color: #0f9d58;
                --paper-toggle-button-unchecked-bar-color:  rgb(221, 44, 0);
                --paper-toggle-button-unchecked-button-color:  rgb(221, 44, 0);
                --paper-toggle-button-unchecked-ink-color: rgb(221, 44, 0);
            }
            .hide {
                display: none;
            }
            .label-addPadding {
                padding-left:20px !important;
            }
            .header {
                padding-top: 15px;
                font-family: 'Roboto', 'Noto', sans-serif;
                -webkit-font-smoothing: antialiased;
                font-size: 20px;
                font-weight: 400;
                letter-spacing: -.012em;
                line-height: 20px;
            }
            .header-container {
                padding-left: 10px;
            }
            .flex-centre {
                justify-content: center
            }
            .column-centre {
                text-align: center
            }
            .small {
                color: #1c7cf1;
                font-size: 0.67em;
            }
            .red {
                color: rgb(221, 44, 0);
            }
            .type0 {
                background: var(--dv-green-900);
                color: var(--dv-main-background);
                width: 100%;
            }

            .type1 {
                background: var(--dv-blue-900);
                color: var(--dv-main-background);
                width: 100%;
            }
        </style>
        <div class="display-flex column">
            <div class="paper-material" elevation="2">
                <div class="paper-material-inner display-flex border-top" style="background: #f5f5f5">
                    <div class="display-flex vertically-align image-holder">
                        <user-image email="[[email]]" size="60"
                                    name="[[username]]"
                                    request-gravatar="{{gravatarSwitch}}"></user-image>
                    </div>

                    <div class="display-flex column flex"
                         style="border-left: 1px solid #ccc; background: #fff; padding-left: 10px">
                        <div class="username-header flex" style="margin-right: 10px;">[[username]]</div>
                        <div class="org">
                            [[organisationName]]
                        </div>
                    </div>
                </div>
            </div>

            <div class="paper-material" elevation="1">
                <div class="paper-material-inner display-flex column">
                    <div class="display-flex row vertically-align">
                        <div class="label bold">Home directory path</div>
                        <div class="value flex">
                            [[homeDir]]
                        </div>
                        <paper-button class="btn" on-tap="_view" data-path$="[[homeDir]]">view</paper-button>
                    </div>
                    <div class="display-flex row vertically-align">
                        <div class="label bold">Root directory path</div>
                        <div class="value flex">
                            [[rootDir]]
                        </div>
                        <paper-button class="btn" on-tap="_view" data-path$="[[rootDir]]">view</paper-button>
                    </div>
                    <div class="display-flex row vertically-align">
                        <div class="label bold">Email address</div>
                        <div class$="[[_computedEmailCss(email)]]">[[email]]</div>
                    </div>
                    <div class="display-flex row vertically-align">
                        <div class="label bold">User identifier (UID)</div>
                        <div class="value">[[uid]]</div>
                    </div>
                    <div class="display-flex row vertically-align">
                        <div class="label bold">Group identifier (GID)</div>
                        <div class="value">[[gids]]</div>
                    </div>
                </div>
            </div>

            <div class="paper-material" elevation="1">
                <div class="header-container">
                    <div class="header">
                        Quota Information
                    </div>
                    <small class="small">
                        Disk & Tape Space Allowances (current / limit)
                    </small>
                </div>
                <br/>
                <vaadin-grid aria-label="Quota Info" id="quotainfo"
                             items="[[quotas]]" multi-sort="true" size="100">
                    <vaadin-grid-column-group>
                        <template class="header">
                                Id
                        </template>
                        <vaadin-grid-column width="15px">
                            <template>
                                <span class$="type[[item.type.value]]">
                                    [[item.id]]
                                </span>
                            </template>
                        </vaadin-grid-column>
                    </vaadin-grid-column-group>
                    <vaadin-grid-column-group>
                        <template class="header">
                                Custodial
                        </template>
                        <vaadin-grid-column width="15px">
                            <template>
                                <span class$="[[_computedColumnCss(item.custodialExceeded)]]">
                                    [[item.custodial]] / [[item.custodialLimit]]
                                </span>
                            </template>
                        </vaadin-grid-column>
                    </vaadin-grid-column-group>
<!--    REVISIT THIS when the qos definitions are reviewed; currently, OUTPUT is unused. -->
<!--                    <vaadin-grid-column-group>-->
<!--                        <template class="header">-->
<!--                                Output-->
<!--                        </template>-->
<!--                        <vaadin-grid-column width="15px">-->
<!--                            <template>-->
<!--                                <span class$="[[_computedColumnCss(item.outputExceeded)]]">-->
<!--                                    [[item.output]] / [[item.outputLimit]]-->
<!--                                </span>-->
<!--                            </template>-->
<!--                        </vaadin-grid-column>-->
<!--                    </vaadin-grid-column-group>-->
                    <vaadin-grid-column-group>
                        <template class="header">
                                Replica
                        </template>
                        <vaadin-grid-column width="15px">
                            <template>
                                <span class$="[[_computedColumnCss(item.replicaExceeded)]]">
                                    [[item.replica]] / [[item.replicaLimit]]
                                </span>
                            </template>
                        </vaadin-grid-column>
                    </vaadin-grid-column-group>
                </vaadin-grid>
            </div>

            <div class="paper-material" elevation="1">
                <div class="header-container">
                    <div class="header">
                        Profile Image
                    </div>
                    <small class="small">
                        Choose which profile image to use.
                    </small>
                </div>
                <div class="paper-material-inner display-flex column">
                    <div class="display-flex row vertically-align">
                        <div class="value flex">
                            Available options:
                        </div>
                    </div>
                    <div class="display-flex row vertically-align">
                        <div class="bold label-addPadding">Identicon -</div>
                        <div class="value flex">
                            <small class="small">&nbsp;generated based on username</small>
                        </div>
                        <paper-toggle-button id="identicon"
                                             checked="[[!gravatarSwitch]]"
                                             on-change="_requestIdenticonImage"
                                             data-id="identicon"
                                             class="toggleBtn"></paper-toggle-button>
                    </div>
                    <div class="display-flex row vertically-align">
                        <div class="bold label-addPadding">Gravatar -</div>
                        <div class="value flex">
                            <small class="small">&nbsp;see https://en.gravatar.com/ for detail</small>
                        </div>
                        <paper-toggle-button id="gravatar"
                                             checked="[[gravatarSwitch]]"
                                             on-change="_requestGravatarImage"
                                             data-id="gravatar"
                                             class="toggleBtn"></paper-toggle-button>
                    </div>
                </div>
            </div>

            <div class="paper-material" elevation="1">
                <div class="header-container">
                    <div class="header">
                        Roles
                    </div>
                    <small class="small">
                        These are optional switch that affect how dCache behaves
                    </small>
                </div>
                <div class="paper-material-inner display-flex column">
                    <div class="display-flex row vertically-align">
                        <div class="value flex">
                            Available role(s):
                        </div>
                        <paper-toggle-button id="allRolesAssertionToggle"
                                             on-change="_roleAssertion"
                                             data-roles="*"
                                             checked="[[_allCurrentStatus()]]"
                                             class$="[[_computedClass('all-roles')]]">Assert all roles
                        </paper-toggle-button>
                    </div>

                    <div class$="[[_computedClass('no-roles')]]" class="flex-centre">
                        <div class="red">
                            <iron-icon icon="visibility-off"></iron-icon>
                            <span> No roles to assert</span>
                        </div>
                    </div>
                    <template is="dom-repeat" items="[[listOfAllRoles]]">
                        <div class="display-flex row vertically-align">
                            <div class="label bold label-addPadding">[[item.role]]</div>
                            <div class="value flex"></div>
                            <paper-toggle-button on-change="_roleAssertion"
                                                 data-roles="[[item.role]]"
                                                 checked="[[item.assert]]"
                                                 class="toggleBtn"></paper-toggle-button>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </template>
    <script src="user-profile.js"></script>
</dom-module>